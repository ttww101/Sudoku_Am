//
//  LTSudokuCollectionViewCell.m
//  LTSoduku
//
//  Created by lt on 2017/9/5.
//  Copyright © 2017年 tl. All rights reserved.
//

#import "LTSudokuCollectionViewCell.h"

@interface LTSudokuCollectionViewCell ()

@property (nonatomic, strong) UILabel *valueLabel;
@property (nonatomic, strong) NSMutableArray *noteLabelArray;

@end

@implementation LTSudokuCollectionViewCell

- (instancetype)initWithFrame:(CGRect)frame
{
    if (self = [super initWithFrame:frame]) {
        [self initView];
    }
    return self;
}

# pragma mark - ui

- (void)initView
{
    [self.contentView addSubview:self.valueLabel];
    [self.contentView.layer addSublayer:self.borderLayer];
    for (UILabel *label in self.noteLabelArray) {
        [self.contentView addSubview:label];
    }
    
}

- (void)layoutSubviews
{
    self.valueLabel.frame = self.contentView.bounds;
    for (NSInteger i = 0; i < 9; i++) {
        UILabel *label = self.noteLabelArray[i];
        [label sizeToFit];
        label.left = (self.contentView.width - label.width - 4) / 2 * (i % 3) + 2;
        label.top = (self.contentView.height - label.height - 4) / 2 * (i / 3) + 2;
    }
    self.borderLayer.frame = CGRectMake(self.contentView.left + 1.5,self.contentView.top + 1 , self.contentView.width - 2.5, self.contentView.height - 2);
}

# pragma mark - set


- (void)setModel:(LTSodukuCellModel *)model
{
    self.backgroundColor = [UIColor whiteColor];
    self.borderLayer.borderWidth = 0;
    
    _model = model;
    self.valueLabel.textAlignment = NSTextAlignmentCenter;
    self.valueLabel.textColor = self.model.editEnabled == YES ? [GState editableCellTextColor] : [UIColor blackColor];
    self.valueLabel.font = [UIFont systemFontOfSize:15];
    
    //    self.valueLabel.text = model.realValue;
    self.valueLabel.text = self.model.editEnabled == YES ? model.inputValue : model.realValue;
    
    if (model.inputValue.length == 0 && model.noteList.count > 0) {
        for (UILabel *label in self.noteLabelArray) {
            for (NSString *noteValue in model.noteList) {
                if ([label.text isEqualToString:noteValue]) {
                    label.hidden = NO;
                    break;
                } else {
                    label.hidden = YES;
                }
            }
        }
    } else {
        for (UILabel *label in self.noteLabelArray) {
            label.hidden = YES;
        }
    }
}


# pragma mark - get

- (UILabel *)valueLabel
{
    if (!_valueLabel)
    {
        _valueLabel = [[UILabel alloc] initWithFrame:CGRectZero];
        _valueLabel.numberOfLines = 3;
    }
    return _valueLabel;
}

- (NSMutableArray *)noteLabelArray
{
    if (!_noteLabelArray)
    {
        _noteLabelArray = [NSMutableArray array];
        for (NSInteger i = 0; i < 9 ; i++) {
            UILabel *label = [[UILabel alloc] init];
            label.font = [UIFont systemFontOfSize:10];
            label.text = [NSString stringWithFormat:@"%ld",(long)i + 1];
            label.textColor = [UIColor flatGrayColor];
            label.hidden = YES;
            [_noteLabelArray addObject:label];
        }
    }
    return _noteLabelArray;
}

- (CALayer *)borderLayer
{
    if (!_borderLayer)
    {
        _borderLayer = [CALayer layer];
    }
    return _borderLayer;
}

@end

